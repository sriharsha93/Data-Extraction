name: Trigger Scrape

on:
  repository_dispatch:
    types: [run_scraper]

jobs:
  run:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout
      uses: actions/checkout@v4

    - name: Run scraper
      env:
        SCHEDULE_PATH: "schedules/match_schedule.csv"
        OUTPUT_DIR: "match_data"
        STATUS_DIR: "status"
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt
        playwright install chromium
        python run_schedule.py

    - name: Commit and push results
      run: |
        git config user.name "github-actions[bot]"
        git config user.email "41898282+github-actions[bot]@users.noreply.github.com"
        git add .
        git diff --staged --quiet || git commit -m "Auto scrape [ci skip]"
        git push
